generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model activity_log {
  id          String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id  String?      @db.Uuid
  task_id     String?      @db.Uuid
  user_id     String?      @db.Uuid
  action      String
  entity_type String
  entity_id   String?      @db.Uuid
  details     Json?        @default("{}")
  old_value   Json?
  new_value   Json?
  ip_address  String?      @db.Inet
  user_agent  String?
  created_at  DateTime?    @default(now()) @db.Timestamptz(6)
  pm_projects pm_projects? @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tasks       tasks?       @relation(fields: [task_id], references: [id], onUpdate: NoAction)
  profiles    profiles?    @relation(fields: [user_id], references: [id], onUpdate: NoAction)

  @@index([created_at(sort: Desc)], map: "idx_activity_log_created")
  @@index([project_id], map: "idx_activity_log_project")
  @@index([user_id], map: "idx_activity_log_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model comments {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  task_id        String?      @db.Uuid
  project_id     String?      @db.Uuid
  content        String
  author_id      String       @db.Uuid
  parent_id      String?      @db.Uuid
  is_internal    Boolean?     @default(false)
  attachments    Json?        @default("[]")
  created_at     DateTime?    @default(now()) @db.Timestamptz(6)
  updated_at     DateTime?    @default(now()) @db.Timestamptz(6)
  profiles       profiles     @relation(fields: [author_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  comments       comments?    @relation("commentsTocomments", fields: [parent_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  other_comments comments[]   @relation("commentsTocomments")
  pm_projects    pm_projects? @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tasks          tasks?       @relation(fields: [task_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([author_id], map: "idx_comments_author")
  @@index([project_id], map: "idx_comments_project")
  @@index([task_id], map: "idx_comments_task")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model contact_requests {
  id             String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name           String
  email          String
  company        String?
  subject        String
  message        String
  project_type   String?
  created_at     DateTime?        @default(now()) @db.Timestamptz(6)
  ticket_number  Int?             @default(autoincrement())
  status         String?          @default("neu")
  notes          String?
  updated_at     DateTime?        @default(now()) @db.Timestamptz(6)
  is_spam        Boolean?         @default(false)
  email_messages email_messages[]
  email_queue    email_queue[]

  @@index([created_at(sort: Desc)], map: "idx_contact_requests_created_at")
  @@index([is_spam], map: "idx_contact_requests_is_spam")
  @@index([status], map: "idx_contact_requests_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model contracts {
  id                                      String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id                              String      @db.Uuid
  title                                   String
  description                             String?
  status                                  String      @default("pending_signature")
  original_pdf_path                       String
  original_pdf_url                        String?
  signed_pdf_path                         String?
  signed_pdf_url                          String?
  signature_data                          String?
  signed_at                               DateTime?   @db.Timestamptz(6)
  signed_by                               String?     @db.Uuid
  signer_ip                               String?
  signer_user_agent                       String?
  valid_until                             DateTime?   @db.Date
  created_by                              String?     @db.Uuid
  created_at                              DateTime?   @default(now()) @db.Timestamptz(6)
  updated_at                              DateTime?   @default(now()) @db.Timestamptz(6)
  profiles_contracts_created_byToprofiles profiles?   @relation("contracts_created_byToprofiles", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  pm_projects                             pm_projects @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  profiles_contracts_signed_byToprofiles  profiles?   @relation("contracts_signed_byToprofiles", fields: [signed_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([created_by], map: "idx_contracts_created_by")
  @@index([project_id], map: "idx_contracts_project")
  @@index([signed_by], map: "idx_contracts_signed_by")
  @@index([status], map: "idx_contracts_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model email_messages {
  id                 String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contact_request_id String?           @db.Uuid
  direction          String
  from_email         String
  from_name          String?
  to_email           String
  subject            String?
  content_html       String?
  content_text       String?
  created_at         DateTime?         @default(now()) @db.Timestamptz(6)
  contact_requests   contact_requests? @relation(fields: [contact_request_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([contact_request_id], map: "idx_email_messages_contact_request")
  @@index([created_at], map: "idx_email_messages_created_at")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model email_queue {
  id                 String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  recipient_email    String
  recipient_name     String?
  subject            String
  content_html       String
  content_text       String?
  status             String?           @default("pending")
  type               String?           @default("notification")
  attempts           Int?              @default(0)
  max_attempts       Int?              @default(3)
  last_attempt_at    DateTime?         @db.Timestamptz(6)
  error_message      String?
  sent_at            DateTime?         @db.Timestamptz(6)
  metadata           Json?             @default("{}")
  created_at         DateTime?         @default(now()) @db.Timestamptz(6)
  contact_request_id String?           @db.Uuid
  contact_requests   contact_requests? @relation(fields: [contact_request_id], references: [id], onUpdate: NoAction)

  @@index([created_at], map: "idx_email_queue_created_at")
  @@index([status], map: "idx_email_queue_status")
  @@index([status, attempts], map: "idx_email_queue_status_attempts")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model email_settings {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  smtp_host     String    @default("smtp.strato.de")
  smtp_port     Int       @default(465)
  smtp_user     String    @default("")
  smtp_password String    @default("")
  imap_host     String?   @default("imap.strato.de")
  imap_port     Int?      @default(993)
  imap_user     String?   @default("")
  imap_password String?   @default("")
  from_email    String    @default("")
  from_name     String    @default("getemergence.com")
  is_active     Boolean?  @default(true)
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  updated_at    DateTime? @default(now()) @db.Timestamptz(6)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model invoices {
  id                        String                      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id                String                      @db.Uuid
  invoice_number            String                      @unique
  title                     String
  description               String?
  amount                    Decimal                     @db.Decimal(10, 2)
  tax_amount                Decimal?                    @default(0) @db.Decimal(10, 2)
  total_amount              Decimal                     @db.Decimal(10, 2)
  currency                  String?                     @default("EUR")
  status                    String                      @default("draft")
  issue_date                DateTime                    @default(dbgenerated("CURRENT_DATE")) @db.Date
  due_date                  DateTime?                   @db.Date
  paid_at                   DateTime?                   @db.Timestamptz(6)
  pdf_url                   String?
  created_by                String?                     @db.Uuid
  created_at                DateTime?                   @default(now()) @db.Timestamptz(6)
  updated_at                DateTime?                   @default(now()) @db.Timestamptz(6)
  lexoffice_id              String?                     @db.Uuid
  lexoffice_status          String?
  synced_at                 DateTime?                   @db.Timestamptz(6)
  line_items                Json?
  profiles                  profiles?                   @relation(fields: [created_by], references: [id], onUpdate: NoAction)
  pm_projects               pm_projects                 @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  recurring_invoice_history recurring_invoice_history[]

  @@index([project_id], map: "idx_invoices_project")
  @@index([status], map: "idx_invoices_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model lexoffice_contacts {
  id                       String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  profile_id               String?        @db.Uuid
  organization_id          String?        @db.Uuid
  lexoffice_contact_id     String         @db.Uuid
  lexoffice_contact_number Int?
  created_at               DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at               DateTime?      @default(now()) @db.Timestamptz(6)
  organizations            organizations? @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  profiles                 profiles?      @relation(fields: [profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([lexoffice_contact_id], map: "idx_lexoffice_contacts_lexoffice_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model lexoffice_sync_log {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  entity_type   String
  entity_id     String    @db.Uuid
  lexoffice_id  String?   @db.Uuid
  action        String
  status        String
  error_message String?
  request_data  Json?
  response_data Json?
  created_at    DateTime? @default(now()) @db.Timestamptz(6)

  @@index([entity_type, entity_id], map: "idx_sync_log_entity")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model monitored_servers {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name             String
  host             String
  agent_port       Int?               @default(9999)
  auth_token       String
  is_active        Boolean?           @default(true)
  created_at       DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?          @default(now()) @db.Timestamptz(6)
  server_databases server_databases[]

  @@index([is_active], map: "idx_monitored_servers_active")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model organization_members {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organization_id String        @db.Uuid
  user_id         String        @db.Uuid
  role            String        @default("member")
  created_at      DateTime?     @default(now()) @db.Timestamptz(6)
  organizations   organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  profiles        profiles      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([organization_id, user_id])
  @@index([organization_id], map: "idx_org_members_org")
  @@index([user_id], map: "idx_org_members_user")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model organizations {
  id                   String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                 String
  slug                 String?                @unique
  logo_url             String?
  street               String?
  postal_code          String?
  city                 String?
  country              String?                @default("Deutschland")
  email                String?
  phone                String?
  website              String?
  created_by           String?                @db.Uuid
  created_at           DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?              @default(now()) @db.Timestamptz(6)
  lexoffice_contacts   lexoffice_contacts[]
  organization_members organization_members[]
  profiles             profiles?              @relation(fields: [created_by], references: [id], onUpdate: NoAction)
  pm_projects          pm_projects[]

  @@index([name], map: "idx_organizations_name")
  @@index([slug], map: "idx_organizations_slug")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model pm_projects {
  id                                        String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                                      String
  description                               String?
  status                                    String               @default("active")
  priority                                  String?              @default("medium")
  client_id                                 String?              @db.Uuid
  manager_id                                String?              @db.Uuid
  start_date                                DateTime?            @db.Date
  due_date                                  DateTime?            @db.Date
  completed_at                              DateTime?            @db.Timestamptz(6)
  budget                                    Decimal?             @db.Decimal(10, 2)
  budget_used                               Decimal?             @default(0) @db.Decimal(10, 2)
  settings                                  Json?                @default("{}")
  created_at                                DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at                                DateTime?            @default(now()) @db.Timestamptz(6)
  organization_id                           String?              @db.Uuid
  activity_log                              activity_log[]
  comments                                  comments[]
  contracts                                 contracts[]
  invoices                                  invoices[]
  profiles_pm_projects_client_idToprofiles  profiles?            @relation("pm_projects_client_idToprofiles", fields: [client_id], references: [id], onUpdate: NoAction)
  profiles_pm_projects_manager_idToprofiles profiles?            @relation("pm_projects_manager_idToprofiles", fields: [manager_id], references: [id], onUpdate: NoAction)
  organizations                             organizations?       @relation(fields: [organization_id], references: [id], onUpdate: NoAction)
  progress_updates                          progress_updates[]
  project_files                             project_files[]
  project_members                           project_members[]
  quotations                                quotations[]
  recurring_invoices                        recurring_invoices[]
  tasks                                     tasks[]

  @@index([client_id], map: "idx_pm_projects_client")
  @@index([manager_id], map: "idx_pm_projects_manager")
  @@index([organization_id], map: "idx_pm_projects_org")
  @@index([status], map: "idx_pm_projects_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model profiles {
  id                                           String                 @id @db.Uuid
  email                                        String                 @unique
  full_name                                    String?
  avatar_url                                   String?
  role                                         String                 @default("user")
  password_hash                                String?
  company                                      String?
  phone                                        String?
  created_at                                   DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at                                   DateTime?              @default(now()) @db.Timestamptz(6)
  first_name                                   String?
  last_name                                    String?
  street                                       String?
  postal_code                                  String?
  city                                         String?
  country                                      String?                @default("Deutschland")
  company_street                               String?
  company_postal_code                          String?
  company_city                                 String?
  company_country                              String?                @default("Deutschland")
  mobile                                       String?
  activity_log                                 activity_log[]
  comments                                     comments[]
  contracts_contracts_created_byToprofiles     contracts[]            @relation("contracts_created_byToprofiles")
  contracts_contracts_signed_byToprofiles      contracts[]            @relation("contracts_signed_byToprofiles")
  invoices                                     invoices[]
  lexoffice_contacts                           lexoffice_contacts[]
  organization_members                         organization_members[]
  organizations                                organizations[]
  pm_projects_pm_projects_client_idToprofiles  pm_projects[]          @relation("pm_projects_client_idToprofiles")
  pm_projects_pm_projects_manager_idToprofiles pm_projects[]          @relation("pm_projects_manager_idToprofiles")
  progress_updates                             progress_updates[]
  project_files                                project_files[]
  project_members                              project_members[]
  quotations                                   quotations[]
  recurring_invoices                           recurring_invoices[]
  system_settings                              system_settings[]
  tasks_tasks_assignee_idToprofiles            tasks[]                @relation("tasks_assignee_idToprofiles")
  tasks_tasks_created_byToprofiles             tasks[]                @relation("tasks_created_byToprofiles")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model progress_updates {
  id                  String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id          String      @db.Uuid
  task_id             String?     @db.Uuid
  title               String
  content             String?
  progress_percentage Int?
  author_id           String      @db.Uuid
  images              Json?       @default("[]")
  attachments         Json?       @default("[]")
  is_public           Boolean?    @default(true)
  created_at          DateTime?   @default(now()) @db.Timestamptz(6)
  profiles            profiles    @relation(fields: [author_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  pm_projects         pm_projects @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tasks               tasks?      @relation(fields: [task_id], references: [id], onUpdate: NoAction)

  @@index([project_id], map: "idx_progress_updates_project")
  @@index([task_id], map: "idx_progress_updates_task")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model project_files {
  id            String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id    String      @db.Uuid
  task_id       String?     @db.Uuid
  name          String
  original_name String
  file_type     String
  mime_type     String?
  size_bytes    BigInt?
  storage_path  String
  url           String?
  uploaded_by   String?     @db.Uuid
  description   String?
  created_at    DateTime?   @default(now()) @db.Timestamptz(6)
  pm_projects   pm_projects @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tasks         tasks?      @relation(fields: [task_id], references: [id], onUpdate: NoAction)
  profiles      profiles?   @relation(fields: [uploaded_by], references: [id], onUpdate: NoAction)

  @@index([project_id], map: "idx_project_files_project")
  @@index([task_id], map: "idx_project_files_task")
  @@index([file_type], map: "idx_project_files_type")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model project_members {
  id          String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id  String      @db.Uuid
  user_id     String      @db.Uuid
  role        String      @default("member")
  created_at  DateTime?   @default(now()) @db.Timestamptz(6)
  pm_projects pm_projects @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  profiles    profiles    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([project_id, user_id])
  @@index([project_id], map: "idx_project_members_project")
  @@index([user_id], map: "idx_project_members_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model quotations {
  id               String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id       String?      @db.Uuid
  quotation_number String       @unique
  title            String
  description      String?
  line_items       Json         @default("[]")
  net_amount       Decimal      @default(0) @db.Decimal(10, 2)
  tax_amount       Decimal      @default(0) @db.Decimal(10, 2)
  total_amount     Decimal      @default(0) @db.Decimal(10, 2)
  currency         String?      @default("EUR")
  status           String       @default("draft")
  valid_until      DateTime?    @db.Date
  sent_at          DateTime?    @db.Timestamptz(6)
  accepted_at      DateTime?    @db.Timestamptz(6)
  rejected_at      DateTime?    @db.Timestamptz(6)
  lexoffice_id     String?      @db.Uuid
  lexoffice_status String?
  synced_at        DateTime?    @db.Timestamptz(6)
  pdf_url          String?
  created_by       String?      @db.Uuid
  created_at       DateTime?    @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?    @default(now()) @db.Timestamptz(6)
  profiles         profiles?    @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  pm_projects      pm_projects? @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([project_id], map: "idx_quotations_project")
  @@index([status], map: "idx_quotations_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model recurring_invoice_history {
  id                   String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  recurring_invoice_id String?             @db.Uuid
  invoice_id           String?             @db.Uuid
  generated_at         DateTime?           @default(now()) @db.Timestamptz(6)
  status               String              @default("success")
  error_message        String?
  recurring_invoices   recurring_invoices? @relation(fields: [recurring_invoice_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_recurring_invoice")
  invoices             invoices?           @relation(fields: [invoice_id], references: [id], onUpdate: NoAction)

  @@index([recurring_invoice_id], map: "idx_recurring_history_recurring")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model recurring_invoices {
  id                        String                      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id                String?                     @db.Uuid
  title                     String
  description               String?
  line_items                Json                        @default("[]")
  net_amount                Decimal                     @default(0) @db.Decimal(10, 2)
  tax_rate                  Int                         @default(19)
  interval_type             String
  interval_value            Int                         @default(1)
  start_date                DateTime                    @db.Date
  end_date                  DateTime?                   @db.Date
  next_invoice_date         DateTime                    @db.Date
  is_active                 Boolean?                    @default(true)
  last_generated_at         DateTime?                   @db.Timestamptz(6)
  invoices_generated        Int?                        @default(0)
  auto_send                 Boolean?                    @default(false)
  send_notification         Boolean?                    @default(true)
  created_by                String?                     @db.Uuid
  created_at                DateTime?                   @default(now()) @db.Timestamptz(6)
  updated_at                DateTime?                   @default(now()) @db.Timestamptz(6)
  recurring_invoice_history recurring_invoice_history[]
  profiles                  profiles?                   @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  pm_projects               pm_projects?                @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([is_active], map: "idx_recurring_invoices_active")
  @@index([project_id], map: "idx_recurring_invoices_project")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model server_databases {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  server_id         String            @db.Uuid
  name              String
  host              String            @default("localhost")
  port              Int               @default(5432)
  database_name     String            @default("postgres")
  username          String
  password          String
  ssl_enabled       Boolean?          @default(false)
  is_active         Boolean?          @default(true)
  created_at        DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?         @default(now()) @db.Timestamptz(6)
  monitored_servers monitored_servers @relation(fields: [server_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([server_id], map: "idx_server_databases_server_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model system_settings {
  key        String    @id
  value      Json
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_by String?   @db.Uuid
  profiles   profiles? @relation(fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model tasks {
  id                                   String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id                           String             @db.Uuid
  title                                String
  description                          String?
  status                               String             @default("backlog")
  priority                             String?            @default("medium")
  assignee_id                          String?            @db.Uuid
  created_by                           String?            @db.Uuid
  parent_task_id                       String?            @db.Uuid
  due_date                             DateTime?          @db.Date
  start_date                           DateTime?          @db.Date
  completed_at                         DateTime?          @db.Timestamptz(6)
  estimated_hours                      Decimal?           @db.Decimal(6, 2)
  actual_hours                         Decimal?           @default(0) @db.Decimal(6, 2)
  position                             Int?               @default(0)
  tags                                 String[]           @default([])
  created_at                           DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at                           DateTime?          @default(now()) @db.Timestamptz(6)
  activity_log                         activity_log[]
  comments                             comments[]
  progress_updates                     progress_updates[]
  project_files                        project_files[]
  profiles_tasks_assignee_idToprofiles profiles?          @relation("tasks_assignee_idToprofiles", fields: [assignee_id], references: [id], onUpdate: NoAction)
  profiles_tasks_created_byToprofiles  profiles?          @relation("tasks_created_byToprofiles", fields: [created_by], references: [id], onUpdate: NoAction)
  tasks                                tasks?             @relation("tasksTotasks", fields: [parent_task_id], references: [id], onUpdate: NoAction)
  other_tasks                          tasks[]            @relation("tasksTotasks")
  pm_projects                          pm_projects        @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([assignee_id], map: "idx_tasks_assignee")
  @@index([project_id, status, position], map: "idx_tasks_position")
  @@index([project_id], map: "idx_tasks_project")
  @@index([status], map: "idx_tasks_status")
}
